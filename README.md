# Проект NoSQL (бронирование комнат), выполнил  Брежнев В.А. группа М80-109М-23

# Используемые технологии:

Язык программирования – Python

Балансировщик нагрузки – nginx

Хранилище данных – mongodb

Поиск – elasticsearch

Виртуализация – docker

Оркестрация – docker-compose

Работа с транзакциями и очередями – hazelcast

Маршрутизация – fastapi

Клиентское приложение – html

# Сценарии использования:

Поиск комнаты по номеру (id)

Бронирование комнаты по имени пользователя и номеру комнаты

# Основные переменные, функции и их назначение:

DATABASE_RESET: Булевая переменная, указывающая, следует ли сбрасывать базу данных при инициализации.

MONGO_URL: Строка подключения к MongoDB. Она содержит имя пользователя, пароль, адрес сервера и порт.

MONGO_DB: Название базы данных MongoDB, с которой будет работать ваше приложение.

get_db(): Функция, создающая экземпляр клиента MongoDB и возвращающая объект базы данных, определенный в MONGO_DB.

es: Экземпляр Elasticsearch, который используется для подключения к Elasticsearch по заданному адресу и порту.

create_es_index(es): Функция для создания индексов в Elasticsearch. Она проверяет существование индексов и, если они не существуют, создает их с заданными настройками и маппингами.

get_es(): Функция, возвращающая глобальный экземпляр Elasticsearch.

logger: Логгер для записи информации о работе приложения. Настроен на уровень INFO.

router: Экземпляр APIRouter из FastAPI, используемый для маршрутизации запросов в приложении.

templates: Экземпляр Jinja2Templates для рендеринга HTML-шаблонов.

# Запуск приложения: 
1. Сборка - команда в терминале: docker-compose up -d --build
2. Инициализация кластера mongoDB - после сборки и запуска скопировать id контейнера mongo (например mongo1-1) и команда в терминале:
docker exec -it <id контейнера> mongosh --eval "rs.initiate({ _id: 'rs0', members: [   {_id: 0, host: 'mongo1'},   {_id: 1, host: 'mongo2'},   {_id: 2, host: 'mongo3'} ]})" 

# Запуск пользовательского интерфейса: http://localhost

# Тест на отказоустойчивость:
Запуск приложения – localhost работает, адреса доступны, страницы отдают ответ
Webapp: При отключении нодов поочерёдно, приложение при их отключении при отправке запроса обрабатывает запрос немного дольше (первый раз), далее как обычно.
Краевое условие – если отключить последнюю ноду, то приложение не работает.
Mongo: при отключении одной ноды приложение работает, связь с БД устанавливается, при отключении второй ноды и перезагрузке приложения выходит ошибка потери связи с БД.

# Архитектура:
![alt text](https://github.com/1985Viacheslav/NoSQL_project_final_with_replicaSet/blob/master/archit.png)
